/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __reflectGet = Reflect.get;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);
var __superGet = (cls, obj, key) => __reflectGet(__getProtoOf(cls), key, obj);
var __async = (__this, __arguments, generator) => {
  return new Promise((resolve, reject) => {
    var fulfilled = (value) => {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    };
    var rejected = (value) => {
      try {
        step(generator.throw(value));
      } catch (e) {
        reject(e);
      }
    };
    var step = (x) => x.done ? resolve(x.value) : Promise.resolve(x.value).then(fulfilled, rejected);
    step((generator = generator.apply(__this, __arguments)).next());
  });
};

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => RpgManager
});
module.exports = __toCommonJS(main_exports);
var import_obsidian8 = require("obsidian");

// src/api.ts
var import_obsidian3 = require("obsidian");

// src/abstracts/AbstractData.ts
var AbstractData = class {
  constructor(api, data) {
    this.api = api;
    this.data = data;
    this.link = data.file.link;
    this.name = data.file.name;
    this.path = data.file.path;
    this.completed = data.completed != null ? data.completed : true;
  }
};
var AbstractImageData = class extends AbstractData {
  constructor(api, data) {
    super(api, data);
    this.imageSrc = api.getImageLink(data);
    this.imageSrcElement = api.getImageElement(data);
    this.image = this.imageSrc !== null ? api.getImage(data) : "";
  }
  getImage(width = 75, height = 75) {
    if (this.imageSrc === null)
      return "";
    return this.api.getImage(this.data, width, height);
  }
};
var AbstractDataList = class {
  constructor(campaign) {
    this.campaign = campaign;
  }
  add(data) {
    this.elements.push(data);
  }
  map(data) {
    const response = /* @__PURE__ */ new Map();
    const character = this.elements.find((t) => t.link === data.link);
    if (character !== void 0) {
      Object.entries(character).forEach(([key, value]) => {
        response.set(key, value);
      });
    }
    return response;
  }
};

// src/data/SessionData.ts
var SessionList = class extends AbstractDataList {
  constructor(campaign) {
    super(campaign);
    this.elements = [];
  }
};
var SessionData = class extends AbstractData {
  constructor(api, data, campaign, adventure = null, previousSession = null, nextSession = null) {
    super(api, data);
    this.campaign = campaign;
    this.adventure = adventure;
    this.previousSession = previousSession;
    this.nextSession = nextSession;
    this.id = this.api.getTagId(data.tags, 2 /* Session */);
    this.adventureId = this.api.getTagId(data.tags, 1 /* Adventure */);
    this.synopsis = data.synopsis;
    if (data.dates.session !== null && data.dates.session !== void 0)
      this.date = this.api.formatDate(data.dates.session, "short");
    if (data.dates.irl !== null && data.dates.irl !== void 0)
      this.irl = this.api.formatDate(data.dates.irl);
  }
};
SessionData.frontmatter = {
  "synopsis": true,
  "ids": {
    "adventure": true,
    "session": true
  },
  "dates": {
    "session": true,
    "irl": false
  }
};

// src/data/AdventureData.ts
var AdventureList = class extends AbstractDataList {
  constructor(campaign) {
    super(campaign);
    this.elements = [];
  }
};
var AdventureData = class extends AbstractData {
  constructor(api, data, campaign) {
    super(api, data);
    this.campaign = campaign;
    this.id = this.api.getTagId(data.tags, 1 /* Adventure */);
    this.synopsis = data.synopsis;
  }
};
AdventureData.frontmatter = {
  "synopsis": true,
  "ids": {
    "adventure": true
  }
};

// src/data/CharacterData.ts
var Pronoun = /* @__PURE__ */ ((Pronoun3) => {
  Pronoun3[Pronoun3["they"] = 0] = "they";
  Pronoun3[Pronoun3["she"] = 1] = "she";
  Pronoun3[Pronoun3["he"] = 2] = "he";
  return Pronoun3;
})(Pronoun || {});
var PronounFactory = class {
  static create(pronoun) {
    let response = null;
    if (pronoun != null) {
      switch (pronoun.toLowerCase()) {
        case "t":
        case "they":
          response = 0 /* they */;
          break;
        case "s":
        case "she":
          response = 1 /* she */;
          break;
        case "h":
        case "he":
          response = 2 /* he */;
          break;
        default:
          response = null;
          break;
      }
    }
    return response;
  }
  static read(pronoun) {
    switch (pronoun) {
      case 0 /* they */:
        return "They/Them";
        break;
      case 1 /* she */:
        return "She/Her";
        break;
      case 2 /* he */:
        return "He/Him";
        break;
    }
  }
};
var CharacterList = class extends AbstractDataList {
  constructor(campaign) {
    super(campaign);
    this.elements = [];
  }
};
var CharacterData = class extends AbstractImageData {
  constructor(api, data, campaign, useAdditionalInformation = null) {
    super(api, data);
    this.campaign = campaign;
    this.age = "";
    this.image = this.api.getImage(data);
    this.age = this.api.calculateAge(data, campaign.currentDate);
    this.isDead = data.dates.death != void 0;
    this.goals = data.goals != void 0 ? data.goals : null;
    this.pronoun = PronounFactory.create(data.pronoun);
    this.synopsis = useAdditionalInformation !== null ? useAdditionalInformation : data.synopsis;
  }
};
CharacterData.frontmatter = {
  "pc": {
    "dates": {
      "dob": true,
      "death": true
    },
    "relationships": {
      "characters": true,
      "factions": true,
      "locations": true
    }
  },
  "npc": {
    "synopsis": true,
    "goals": true,
    "dates": {
      "dob": true,
      "death": true
    },
    "relationships": {
      "characters": true,
      "factions": true,
      "locations": true
    }
  }
};

// src/data/ClueData.ts
var ClueList = class extends AbstractDataList {
  constructor(campaign) {
    super(campaign);
    this.elements = [];
  }
};
var ClueData = class extends AbstractImageData {
  constructor(api, data, campaign, useAdditionalInformation = null) {
    super(api, data);
    this.campaign = campaign;
    this.image = this.api.getImage(data);
    if (data.dates.found !== null && data.dates.found !== void 0 && data.dates.found !== false) {
      this.found = this.api.formatDate(data.dates.found, "long");
    } else {
      this.found = false;
    }
    this.synopsis = useAdditionalInformation !== null ? useAdditionalInformation : data.synopsis;
  }
};
ClueData.frontmatter = {
  "synopsis": true,
  "dates": {
    "found": false
  },
  "relationships": {
    "characters": true,
    "locations": true
  }
};

// src/data/ImageData.ts
var ImageData = class extends AbstractImageData {
  constructor(api, data, width = 75, height = 75) {
    super(api, data);
    this.image = this.imageSrc !== null ? this.api.getImage(data, width, height) : "";
  }
};

// src/data/SynopsisData.ts
var SynopsisData = class extends AbstractData {
  constructor(api, data, title = null) {
    var _a, _b;
    super(api, data);
    this.title = title;
    this.synopsis = data.synopsis !== null ? data.synopsis : "";
    this.death = ((_a = data.dates) == null ? void 0 : _a.death) !== void 0 && ((_b = data.dates) == null ? void 0 : _b.death) !== void 0 ? this.api.formatDate(data.dates.death, "short") : "";
    this.isCharacter = false;
    data.tags.forEach((tag) => {
      if (tag.startsWith(this.api.settings.npcTag) || tag.startsWith(this.api.settings.pcTag)) {
        this.isCharacter = true;
        this.pronoun = PronounFactory.create(data.pronoun);
      }
    });
  }
};

// src/data/LocationData.ts
var LocationList = class extends AbstractDataList {
  constructor(campaign) {
    super(campaign);
    this.elements = [];
  }
};
var LocationData = class extends AbstractImageData {
  constructor(api, data, campaign, useAdditionalInformation = null) {
    super(api, data);
    this.campaign = campaign;
    this.address = data.address;
    this.synopsis = useAdditionalInformation !== null ? useAdditionalInformation : data.synopsis;
  }
};
LocationData.frontmatter = {
  "synopsis": true,
  "address": false
};

// src/data/index.ts
var data_exports = {};
__export(data_exports, {
  AdventureData: () => AdventureData,
  AdventureList: () => AdventureList,
  CampaignData: () => CampaignData,
  CharacterData: () => CharacterData,
  CharacterList: () => CharacterList,
  ClueData: () => ClueData,
  ClueList: () => ClueList,
  EventData: () => EventData,
  EventList: () => EventList,
  FactionData: () => FactionData,
  FactionList: () => FactionList,
  ImageData: () => ImageData,
  LocationData: () => LocationData,
  LocationList: () => LocationList,
  Pronoun: () => Pronoun,
  PronounFactory: () => PronounFactory,
  SceneData: () => SceneData,
  SceneList: () => SceneList,
  SessionData: () => SessionData,
  SessionList: () => SessionList,
  SynopsisData: () => SynopsisData,
  TimelineData: () => TimelineData,
  TimelineList: () => TimelineList
});

// src/data/CampaignData.ts
var CampaignData = class extends AbstractImageData {
  constructor(api, data) {
    super(api, data);
    this.currentDate = data.dates.current;
    this.id = this.api.getTagId(data.tags, 0 /* Campaign */);
  }
};
CampaignData.frontmatter = {
  "dates": {
    "current": true
  }
};

// src/data/EventData.ts
var EventList = class extends AbstractDataList {
  constructor(campaign) {
    super(campaign);
    this.elements = [];
  }
};
var EventData = class extends AbstractImageData {
  constructor(api, data, campaign, useAdditionalInformation = null) {
    super(api, data);
    this.campaign = campaign;
    if (data.dates.event != null)
      this.date = this.api.formatDate(data.dates.event, "short");
    this.synopsis = useAdditionalInformation !== null ? useAdditionalInformation : data.synopsis;
  }
};
EventData.frontmatter = {
  "synopsis": true,
  "dates": {
    "event": true
  },
  "relationships": {
    "characters": true,
    "clues": true,
    "locations": true
  }
};

// src/data/FactionData.ts
var FactionList = class extends AbstractDataList {
  constructor(campaign) {
    super(campaign);
    this.elements = [];
  }
};
var FactionData = class extends AbstractImageData {
  constructor(api, data, campaign, useAdditionalInformation = null) {
    super(api, data);
    this.campaign = campaign;
    this.synopsis = useAdditionalInformation !== null ? useAdditionalInformation : data.synopsis;
  }
};
FactionData.frontmatter = {
  "synopsis": true,
  "relationships": {
    "locations": true
  }
};

// src/data/SceneData.ts
var SceneList = class extends AbstractDataList {
  constructor(campaign) {
    super(campaign);
    this.elements = [];
  }
};
var SceneData = class extends AbstractImageData {
  constructor(api, data, campaign, adventure = null, session = null, previousScene = null, nextScene = null) {
    var _a, _b;
    super(api, data);
    this.campaign = campaign;
    this.adventure = adventure;
    this.session = session;
    this.previousScene = previousScene;
    this.nextScene = nextScene;
    this.duration = "";
    this.action = data.action != void 0 ? data.action : "";
    this.synopsis = data.synopsis != void 0 ? data.synopsis : "";
    this.startTime = this.api.formatTime((_a = data.time) == null ? void 0 : _a.start);
    this.endTime = this.api.formatTime((_b = data.time) == null ? void 0 : _b.end);
    this.id = this.api.getTagId(data.tags, 3 /* Scene */);
    this.sessionId = this.api.getTagId(data.tags, 2 /* Session */);
    this.adventureId = this.api.getTagId(data.tags, 1 /* Adventure */);
    if (this.startTime !== "" && this.endTime !== "") {
      this.duration = this.api.calculateDuration(data.time.start, data.time.end);
    }
  }
};
SceneData.frontmatter = {
  "synopsis": true,
  "action": true,
  "ids": {
    "session": true,
    "scene": true
  },
  "relationships": {
    "characters": true,
    "clues": true,
    "locations": true
  },
  "time": {
    "start": false,
    "end": false
  }
};

// src/data/TimelineData.ts
var TimelineList = class extends AbstractDataList {
  constructor(campaign) {
    super(campaign);
    this.elements = [];
  }
  sort() {
    this.elements.sort((a, b) => {
      return a.datetime - b.datetime;
    });
  }
};
var TimelineData = class extends AbstractImageData {
  constructor(api, data, type) {
    super(api, data);
    this.type = type;
    this.image = this.api.getImage(data, 70);
    this.synopsis = data.synopsis;
    switch (type) {
      case "event":
        this.datetime = data.dates.event;
        break;
      case "death":
        this.datetime = data.dates.death;
        break;
      case "birth":
        this.datetime = data.dates.dob;
        break;
      case "session":
        this.datetime = data.dates.session;
        break;
      case "clue":
        this.datetime = data.dates.found;
        break;
    }
    this.date = this.api.formatDate(this.datetime, "short");
    this.time = this.api.formatTime(this.datetime);
  }
  getEventColour() {
    switch (this.type) {
      case "event":
        return "";
        break;
      case "birth":
        return "green";
        break;
      case "death":
        return "red";
        break;
      case "session":
        return "blue";
        break;
      case "clue":
        return "purple";
        break;
    }
    return "";
  }
};

// src/factories/DataFactory.ts
var DataFactory = class {
  static create(type, api, campaign, current, record, additionalInformation) {
    return this["create" + DataType[type]](api, campaign, current, record, additionalInformation);
  }
  static createCharacter(api, campaign, current, record, additionalInformation) {
    return new CharacterData(api, record, campaign, additionalInformation);
  }
  static createLocation(api, campaign, current, record, additionalInformation) {
    return new LocationData(api, record, campaign, additionalInformation);
  }
  static createEvent(api, campaign, current, record, additionalInformation) {
    return new EventData(api, record, campaign, additionalInformation);
  }
  static createClue(api, campaign, current, record, additionalInformation) {
    return new ClueData(api, record, campaign, additionalInformation);
  }
  static createFaction(api, campaign, current, record, additionalInformation) {
    return new FactionData(api, record, campaign, additionalInformation);
  }
};

// src/io/IoData.ts
var DataType = /* @__PURE__ */ ((DataType2) => {
  DataType2[DataType2["Campaign"] = 0] = "Campaign";
  DataType2[DataType2["Adventure"] = 1] = "Adventure";
  DataType2[DataType2["Session"] = 2] = "Session";
  DataType2[DataType2["Scene"] = 3] = "Scene";
  DataType2[DataType2["Character"] = 4] = "Character";
  DataType2[DataType2["NonPlayerCharacter"] = 5] = "NonPlayerCharacter";
  DataType2[DataType2["Location"] = 6] = "Location";
  DataType2[DataType2["Event"] = 7] = "Event";
  DataType2[DataType2["Clue"] = 8] = "Clue";
  DataType2[DataType2["Faction"] = 9] = "Faction";
  DataType2[DataType2["Note"] = 10] = "Note";
  return DataType2;
})(DataType || {});
var IoData = class {
  constructor(api, campaign, dv, current) {
    this.api = api;
    this.campaign = campaign;
    this.dv = dv;
    this.current = current;
    this.id = null;
    var _a, _b;
    this.outlinks = [];
    this.readOutlinks();
    const corePlugin = (_a = this.api.app.internalPlugins) == null ? void 0 : _a.plugins["templates"];
    this.templateFolder = corePlugin.instance.options.folder;
    if (((_b = this.current) == null ? void 0 : _b.tags) != null) {
      this.current.tags.forEach((tag) => {
        if (tag.startsWith(this.api.settings.campaignTag)) {
          this.api.getTagId(this.current.tags, 0 /* Campaign */);
        } else if (tag.startsWith(this.api.settings.adventureTag)) {
          this.api.getTagId(this.current.tags, 1 /* Adventure */);
        } else if (tag.startsWith(this.api.settings.sessionTag)) {
          this.api.getTagId(this.current.tags, 2 /* Session */);
        } else if (tag.startsWith(this.api.settings.sceneTag)) {
          this.api.getTagId(this.current.tags, 3 /* Scene */);
        }
      });
    }
  }
  readOutlinks() {
    if (this.current != void 0) {
      this.current.file.outlinks.forEach((file) => {
        const page = this.dv.page(file.path);
        if (page != void 0) {
          this.outlinks.push(page);
        }
      });
    }
  }
  isAlreadyPresent(list, element) {
    let response = false;
    list.elements.forEach((existingElement) => {
      if (element.file.path === existingElement.path) {
        response = true;
        return true;
      }
    });
    return response;
  }
  hasMainTag(page, type) {
    if (page.tags == void 0) {
      return false;
    }
    switch (type) {
      case 4 /* Character */:
        return page.tags.indexOf(this.api.settings.npcTag) !== -1 || page.tags.indexOf(this.api.settings.pcTag) !== -1;
        break;
      case 8 /* Clue */:
        return page.tags.indexOf(this.api.settings.clueTag) !== -1;
        break;
      case 6 /* Location */:
        return page.tags.indexOf(this.api.settings.locationTag) !== -1;
        break;
      case 9 /* Faction */:
        return page.tags.indexOf(this.api.settings.factionTag) !== -1;
        break;
      case 7 /* Event */:
        return page.tags.indexOf(this.api.settings.eventTag) !== -1;
        break;
      default:
        return false;
        break;
    }
  }
  getCorrectTag(type) {
    let response = "";
    switch (type) {
      case 4 /* Character */:
        response = "(#" + this.api.settings.npcTag + "/" + this.campaign.id + " or #" + this.api.settings.pcTag + "/" + this.campaign.id + ")";
        break;
      case 8 /* Clue */:
        response = "#" + this.api.settings.clueTag + "/" + this.campaign.id;
        break;
      case 6 /* Location */:
        response = "#" + this.api.settings.locationTag + "/" + this.campaign.id;
        break;
      case 9 /* Faction */:
        response = "#" + this.api.settings.factionTag + "/" + this.campaign.id;
        break;
      case 7 /* Event */:
        response = "#" + this.api.settings.eventTag + "/" + this.campaign.id;
        break;
    }
    return response;
  }
  getAdventureList() {
    const response = new AdventureList(this.campaign);
    const query = "#" + this.api.settings.adventureTag + "/" + this.campaign.id;
    this.dv.pages(query).where((adventure) => adventure.file.folder !== this.templateFolder).sort((adventure) => -this.api.getTagId(adventure.tags, 1 /* Adventure */)).forEach((adventure) => {
      response.add(new AdventureData(this.api, adventure, this.campaign));
    });
    return response;
  }
  getAdventure(adventureId) {
    let response = null;
    const query = "#" + this.api.settings.adventureTag + "/" + this.campaign.id + "/" + adventureId;
    const adventures = this.dv.pages(query);
    if (adventures !== null && adventures.length === 1) {
      response = new AdventureData(this.api, adventures[0], this.campaign);
    }
    return response;
  }
  getSession(adventureId, sessionId) {
    let response = null;
    let sessions;
    if (adventureId != null) {
      const query = "#" + this.api.settings.sessionTag + "/" + this.campaign.id + "/" + adventureId + "/" + sessionId;
      sessions = this.dv.pages(query);
    } else {
      const query = "#" + this.api.settings.sessionTag + "/" + this.campaign.id;
      sessions = this.dv.pages(query).where((session) => this.api.getTagId(session.tags, 2 /* Session */) === sessionId);
    }
    if (sessions !== null && sessions.length === 1) {
      response = new SessionData(this.api, sessions[0], this.campaign);
    }
    return response;
  }
  getSessionList(adventureId = null) {
    const response = new SessionList(this.campaign);
    const query = "#" + this.api.settings.sessionTag + "/" + this.campaign.id + (adventureId !== null ? "/" + adventureId : "");
    this.dv.pages(query).where((session) => session.file.folder !== this.templateFolder).sort((session) => -this.api.getTagId(session.tags, 2 /* Session */)).forEach((session) => {
      response.add(new SessionData(this.api, session, this.campaign));
    });
    return response;
  }
  getSceneList(adventureId, sessionId) {
    const response = new SceneList(this.campaign);
    const query = "#" + this.api.settings.sceneTag + "/" + this.campaign.id + "/" + adventureId + "/" + sessionId;
    this.dv.pages(query).where((page) => page.file.folder !== this.templateFolder).sort((scene) => this.api.getTagId(scene.tags, 3 /* Scene */)).forEach((scene) => {
      response.add(new SceneData(this.api, scene, this.campaign));
    });
    return response;
  }
  getCharacterList() {
    const response = new CharacterList(this.campaign);
    const query = "(#" + this.api.settings.npcTag + "/" + this.campaign.id + " or #" + this.api.settings.pcTag + "/" + this.campaign.id + ")";
    this.dv.pages(query).where((character) => character.file.folder !== this.templateFolder).sort((character) => character.file.name).forEach((character) => {
      response.add(new CharacterData(this.api, character, this.campaign));
    });
    return response;
  }
  getClue() {
    return new ClueData(this.api, this.current, this.campaign);
  }
  getImage(width = 75, height = 75) {
    return new ImageData(this.api, this.current, width, height);
  }
  getSynopsis(title = null) {
    return new SynopsisData(this.api, this.current, title);
  }
  getScene(adventureId, sessionId, sceneId) {
    let response = null;
    if (adventureId === null || sessionId === null || sceneId === null) {
      response = new SceneData(this.api, this.current, this.campaign);
    } else {
      const query = "#" + this.api.settings.sceneTag + "/" + this.campaign.id + "/" + adventureId + "/" + sessionId + "/" + sceneId;
      const scenes = this.dv.pages(query);
      if (scenes !== null && scenes.length === 1) {
        response = new SceneData(this.api, scenes[0], this.campaign);
      }
    }
    return response;
  }
  getRelationshipList(type, parentType = null, sorting = null) {
    const response = new data_exports[DataType[type] + "List"](this.campaign);
    this.variableSingular = DataType[type].toLowerCase();
    this.variablePlural = this.variableSingular + "s";
    const defaultSorting = function(page) {
      return page.file.name;
    };
    let comparison;
    if (parentType === null) {
      comparison = function(page) {
        return page.file.folder !== this.templateFolder && this.current.relationships != void 0 && this.current.relationships[this.variablePlural] != void 0 && this.current.relationships[this.variablePlural][page.file.name] !== void 0;
      }.bind(this);
    } else {
      this.variableParentSingular = DataType[parentType].toLowerCase();
      this.variableParentPlural = this.variableParentSingular + "s";
      comparison = function(page) {
        return page.file.folder !== this.templateFolder && page.relationships != void 0 && page.relationships[this.variableParentPlural] != void 0 && page.relationships[this.variableParentPlural][this.current.file.name] !== void 0;
      }.bind(this);
    }
    const query = this.getCorrectTag(type);
    this.dv.pages(query).where(comparison).sort(sorting !== null ? sorting : defaultSorting).forEach((page) => {
      response.add(DataFactory.create(type, this.api, this.campaign, this.current, page, parentType === null ? this.current.relationships[this.variablePlural][page.file.name] : page.relationships[DataType[parentType].toLowerCase() + "s"][this.current.file.name]));
    });
    this.outlinks.forEach((page) => {
      if (this.hasMainTag(page, type) && !this.isAlreadyPresent(response, page)) {
        response.add(DataFactory.create(type, this.api, this.campaign, this.current, page, "_in main description_"));
      }
    });
    return response;
  }
};

// src/views/templates/index.ts
var templates_exports = {};
__export(templates_exports, {
  AdventureModal: () => AdventureModal,
  AdventureTemplate: () => AdventureTemplate,
  CampaignModal: () => CampaignModal,
  CampaignTemplate: () => CampaignTemplate,
  CharacterModal: () => CharacterModal,
  CharacterTemplate: () => CharacterTemplate,
  ClueModal: () => ClueModal,
  ClueTemplate: () => ClueTemplate,
  EventModal: () => EventModal,
  EventTemplate: () => EventTemplate,
  FactionModal: () => FactionModal,
  FactionTemplate: () => FactionTemplate,
  LocationModal: () => LocationModal,
  LocationTemplate: () => LocationTemplate,
  NonPlayerCharacterModal: () => NonPlayerCharacterModal,
  NonPlayerCharacterTemplate: () => NonPlayerCharacterTemplate,
  SceneModal: () => SceneModal,
  SceneTemplate: () => SceneTemplate,
  SessionModal: () => SessionModal,
  SessionTemplate: () => SessionTemplate
});

// src/abstracts/AbstractTemplate.ts
var AbstractTemplate = class {
  constructor(settings, name, campaignId, adventureId, sessionId, sceneId) {
    this.settings = settings;
    this.name = name;
    this.campaignId = campaignId;
    this.adventureId = adventureId;
    this.sessionId = sessionId;
    this.sceneId = sceneId;
  }
  generateData() {
    let response = "";
    response += this.generateFrontmatter();
    response += this.generateTemplate();
    return response;
  }
  generateFrontmatter() {
    let response = "---\n";
    response += "alias: []\n";
    response += this.generateFrontmatterTags();
    response += this.generateFrontmatterSynopsis();
    response += this.generateFrontmatterAction();
    response += this.generateFrontmatterGoals();
    response += this.generateFrontmatterAdditionalInformation();
    const dates = this.generateFrontmatterDates();
    if (dates !== null) {
      response += "dates:\n" + dates;
    }
    const times = this.generateFrontmatterTimes();
    if (times !== null) {
      response += "time:\n" + times;
    }
    const relationships = this.generateFrontmatterRelationships();
    if (relationships !== null) {
      response += "relationships: \n" + relationships;
    }
    response += "completed: false\n";
    response += "---\n";
    return response;
  }
  generateFrontmatterRelationships() {
    return null;
  }
  generateFrontmatterDates() {
    return null;
  }
  generateFrontmatterTimes() {
    return null;
  }
  generateFrontmatterSynopsis() {
    return "";
  }
  generateFrontmatterAdditionalInformation() {
    return "";
  }
  generateFrontmatterAction() {
    return "";
  }
  generateFrontmatterGoals() {
    return "";
  }
  getHeader(title, level = 2) {
    return "#".repeat(level) + " " + title + "\n";
  }
  getRpgManagerCodeblock(funct) {
    return "```RpgManager\n" + funct + "\n```\n";
  }
  getAbtPlot() {
    return ">\n>\n>\n>**AND** \n>\n>**BUT** \n>\n>**THEREFORE** \n>\n\n";
  }
  getAdditionalInformation() {
    return this.getHeader("Additional Information") + "\n";
  }
  getStoryCirclePlot() {
    return ">\n>**YOU**: \n>**NEED**: \n>**GO**: \n>**SEARCH**: \n>**FIND**: \n>**TAKE**: \n>**RETURN**: \n>**CHANGE**: \n>\n\n";
  }
  getNotes() {
    return this.getHeader("Notes") + "- \n\n";
  }
  getStory() {
    return this.getHeader("Story") + "\n\n";
  }
  getPlayerCharacterDetails() {
    return '## Backstory\n\n## Questionnaire\nWhere and when were you born?\n>\n\nWho are/were your parents?\n>1.  \n>2.  \n\nDo you have any siblings?\n>\n\nWrite a full physical description of yourself.\n>\n\nTo which social class do you belong?\n>\n\nDo you have any allergies, diseases or other physical or mental weaknesses?\n>\n\nAre you right-handed or left-handed?\n>\n\nWhat do you have in your pockets?\n> 1. \n> 2. \n> 3. \n> 4.\n\nDo you have any quirks, strange mannerism, annoying habits, or other defining characteristics?\n>\n\nWhat are you afraid of?\n>\n\nWhat defining moments have you experienced?\n>\n\nWhat things matter to you?\n>\n\nWhat do you believe in?\n>\n\nWhat is your idol?\n>\n\nWhat is your desire?\n>\n\nWhat is your "normal"?\n>\n\nWhat is your "secret"?\n>\n\nWhat do you want to do when you "grow up"?\n>\n\nWrite and answer 5 questions about your character.\n 1. \n 2. \n 3. \n 4. \n\nDo you have any allergy?\n>';
  }
};

// src/abstracts/AbstractTemplateModal.ts
var import_obsidian = require("obsidian");
var RpgmElement = class {
  constructor(type, id, name) {
    this.type = type;
    this.id = id;
    this.name = name;
  }
};
var AbstractTemplateModal = class extends import_obsidian.Modal {
  constructor(api, type, create, name) {
    super(api.app);
    this.api = api;
    this.type = type;
    this.create = create;
    this.name = name;
    this.confirm = false;
    this.newCampaignId = 1;
    this.newAdventureId = 1;
    this.newSessionId = 1;
    this.newSceneId = 1;
    this.confirm = false;
  }
  onOpen() {
    super.onOpen();
    const { contentEl } = this;
    contentEl.addClass("rpgm-modal");
    this.initialiseCampaigns();
    if (this.campaigns.length < 1 && this.type !== 0 /* Campaign */) {
      contentEl.createEl("h2", { cls: "rpgm-modal-title", text: "Main campaign missing" });
      contentEl.createSpan({ cls: "", text: "This Obsidian Vault does not contain a Rpg Manager campaign yet. Before creating a " + DataType[this.type] + ", please initialise your first campaign." });
    } else {
      contentEl.createEl("h2", { cls: "rpgm-modal-title", text: "Create New " + DataType[this.type] });
      contentEl.createEl("p", { text: "Title of your new " + DataType[this.type] });
      this.title = contentEl.createEl("input", { type: "text" });
      if (this.name !== null) {
        this.title.value = this.name;
      }
      this.titleError = contentEl.createEl("p", { cls: "error" });
      this.content(contentEl);
      this.button = contentEl.createEl("button", { cls: "mod-cta", text: "Create" });
      this.button.addEventListener("click", (e) => {
        this.confirmed = true;
        this.save();
      });
    }
  }
  save() {
    let validation = this.titleValidation();
    if (this.type !== 0 /* Campaign */) {
      validation = validation && this.campaignValidation();
      if (this.type === 2 /* Session */ || this.type === 3 /* Scene */) {
        if (this.type === 3 /* Scene */) {
        }
      }
    }
    if (validation) {
      let campaignId = this.newCampaignId;
      let adventureId = this.newAdventureId;
      let sessionId = this.newSessionId;
      const sceneId = this.newSceneId;
      if (this.type !== 0 /* Campaign */) {
        campaignId = +this.campaign.value;
      }
      if (this.type === 2 /* Session */ || this.type === 3 /* Scene */) {
        adventureId = +this.adventure.value;
        if (this.type === 3 /* Scene */) {
          sessionId = +this.session.value;
        }
      }
      this.api.fileFactory.create(this.type, this.create, this.title.value, campaignId, adventureId, sessionId, sceneId);
      this.close();
    }
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
  removeOptions(select) {
    const L = select.options.length - 1;
    for (let i = L; i >= 0; i--) {
      select.remove(i);
    }
  }
  titleValidation() {
    let response = true;
    this.titleError.style.display = "none";
    if (this.title.value === "") {
      this.titleError.style.display = "block";
      this.titleError.textContent = "You must add a title for your " + DataType[this.type];
      response = false;
    }
    return response;
  }
  initialiseCampaigns() {
    this.campaigns = [];
    this.api.app.vault.getFiles().forEach((file) => {
      const metadata = this.api.app.metadataCache.getFileCache(file);
      if (metadata !== null && metadata.frontmatter != null && metadata.frontmatter.tags != null && metadata.frontmatter.tags.length > 0) {
        const tags = typeof metadata.frontmatter.tags === "string" ? [metadata.frontmatter.tags] : metadata.frontmatter.tags;
        tags.forEach((tag) => {
          if (typeof tag === "string" && tag.startsWith(this.api.settings.campaignTag)) {
            const campaignId = +tag.substring(tag.lastIndexOf("/") + 1);
            if (campaignId >= this.newCampaignId) {
              this.newCampaignId = campaignId + 1;
            }
            this.campaigns.push(new RpgmElement(0 /* Campaign */, campaignId, file.basename));
          }
        });
      }
    });
    this.campaigns.sort((n1, n2) => {
      return n1.id - n2.id;
    });
  }
  campaignBlock(contentEl) {
    contentEl.createEl("p", { text: "Campaign" });
    this.campaign = contentEl.createEl("select");
    if (this.campaigns.length > 1) {
      this.campaign.createEl("option", {
        text: "",
        value: ""
      }).selected = true;
    }
    this.campaigns.forEach((campaign) => {
      this.campaign.createEl("option", {
        text: campaign.name,
        value: campaign.id.toString()
      }).selected = true;
    });
    this.campaign.addEventListener("change", (e) => {
      this.initialiseAdventures();
    });
    this.campaignError = contentEl.createEl("p", { cls: "error" });
  }
  campaignValidation() {
    let response = true;
    this.campaignError.style.display = "none";
    if (this.campaign.value === "") {
      this.campaignError.style.display = "block";
      this.campaignError.textContent = "You must select a valid campaign for your " + DataType[this.type];
      response = false;
    }
    return response;
  }
  initialiseAdventures() {
    this.newAdventureId = 1;
    this.adventures = [];
    this.api.app.vault.getFiles().forEach((file) => {
      const metadata = this.api.app.metadataCache.getFileCache(file);
      if (metadata !== null && metadata.frontmatter != null && metadata.frontmatter.tags != null && metadata.frontmatter.tags.length > 0) {
        const tags = typeof metadata.frontmatter.tags === "string" ? [metadata.frontmatter.tags] : metadata.frontmatter.tags;
        tags.forEach((tag) => {
          if (typeof tag === "string" && tag.startsWith(this.api.settings.adventureTag + "/" + this.campaign.value)) {
            const adventureId = +tag.substring(tag.lastIndexOf("/") + 1);
            if (adventureId >= this.newAdventureId) {
              this.newAdventureId = adventureId + 1;
            }
            this.adventures.push(new RpgmElement(1 /* Adventure */, adventureId, file.basename));
          }
        });
      }
    });
    this.adventures.sort((n1, n2) => {
      return n1.id - n2.id;
    });
  }
  adventureBlock(contentEl) {
    contentEl.createEl("p", { text: "Adventure" });
    this.adventure = contentEl.createEl("select");
    this.refreshAdventureBlock();
    this.adventure.addEventListener("change", (e) => {
      this.initialiseSessions();
      this.refreshSessionBlock();
    });
    this.adventureError = contentEl.createEl("p", { cls: "error" });
  }
  refreshAdventureBlock() {
    if (this.adventure != null) {
      this.removeOptions(this.adventure);
      this.adventures.forEach((adventure) => {
        this.adventure.createEl("option", {
          text: adventure.name,
          value: adventure.id.toString()
        }).selected = true;
      });
    }
  }
  adventureValidation() {
    let response = true;
    this.adventureError.style.display = "none";
    if (this.adventure.value === "") {
      this.adventureError.style.display = "block";
      this.adventureError.textContent = "You must select a valid adventure for your " + DataType[this.type];
      response = false;
    }
    return response;
  }
  initialiseSessions() {
    this.newSessionId = 1;
    this.sessions = [];
    this.api.app.vault.getFiles().forEach((file) => {
      const metadata = this.api.app.metadataCache.getFileCache(file);
      if (metadata !== null && metadata.frontmatter != null && metadata.frontmatter.tags != null && metadata.frontmatter.tags.length > 0) {
        const tags = typeof metadata.frontmatter.tags === "string" ? [metadata.frontmatter.tags] : metadata.frontmatter.tags;
        tags.forEach((tag) => {
          if (typeof tag === "string" && tag.startsWith(this.api.settings.sessionTag + "/" + this.campaign.value + "/" + this.adventure.value)) {
            const sessionId = +tag.substring(tag.lastIndexOf("/") + 1);
            if (sessionId >= this.newSessionId) {
              this.newSessionId = sessionId + 1;
            }
            this.sessions.push(new RpgmElement(2 /* Session */, sessionId, file.basename));
          }
        });
      }
    });
    this.sessions.sort((n1, n2) => {
      return n1.id - n2.id;
    });
  }
  sessionBlock(contentEl) {
    contentEl.createEl("p", { text: "Session" });
    this.session = contentEl.createEl("select");
    this.refreshSessionBlock();
    this.session.addEventListener("change", (e) => {
      this.initialiseScenes();
    });
    this.sessionError = contentEl.createEl("p", { cls: "error" });
  }
  refreshSessionBlock() {
    if (this.session != null) {
      this.removeOptions(this.session);
      this.sessions.forEach((session) => {
        this.session.createEl("option", {
          text: session.name,
          value: session.id.toString()
        }).selected = true;
      });
    }
  }
  sessionValidation() {
    let response = true;
    this.sessionError.style.display = "none";
    if (this.session.value === "") {
      this.sessionError.style.display = "block";
      this.sessionError.textContent = "You must select a valid session for your " + DataType[this.type];
      response = false;
    }
    return response;
  }
  initialiseScenes() {
    this.newSceneId = 1;
    this.scenes = [];
    this.api.app.vault.getFiles().forEach((file) => {
      const metadata = this.api.app.metadataCache.getFileCache(file);
      if (metadata !== null && metadata.frontmatter != null && metadata.frontmatter.tags != null && metadata.frontmatter.tags.length > 0) {
        const tags = typeof metadata.frontmatter.tags === "string" ? [metadata.frontmatter.tags] : metadata.frontmatter.tags;
        tags.forEach((tag) => {
          if (typeof tag === "string" && tag.startsWith(this.api.settings.sceneTag + "/" + this.campaign.value + "/" + this.adventure.value + "/" + this.session.value)) {
            const sceneId = +tag.substring(tag.lastIndexOf("/") + 1);
            if (sceneId >= this.newSceneId) {
              this.newSceneId = sceneId + 1;
            }
            this.scenes.push(new RpgmElement(3 /* Scene */, sceneId, file.basename));
          }
        });
      }
    });
    this.scenes.sort((n1, n2) => {
      return n1.id - n2.id;
    });
  }
};

// src/views/templates/FactionTemplate.ts
var FactionTemplate = class extends AbstractTemplate {
  generateFrontmatterTags() {
    return "tags: [" + this.settings.factionTag + "/" + this.campaignId + "]\n";
  }
  generateFrontmatterSynopsis() {
    return 'synopsis: ""\n';
  }
  generateFrontmatterRelationships() {
    return " locations: \n";
  }
  generateTemplate() {
    let response = this.getRpgManagerCodeblock("faction");
    response += this.getAdditionalInformation();
    return response;
  }
};
var FactionModal = class extends AbstractTemplateModal {
  content(contentEl) {
    this.campaignBlock(contentEl);
  }
};

// src/views/templates/LocationTemplate.ts
var LocationTemplate = class extends AbstractTemplate {
  generateFrontmatterTags() {
    return "tags: [" + this.settings.locationTag + "/" + this.campaignId + "]\n";
  }
  generateFrontmatterSynopsis() {
    return 'synopsis: ""\n';
  }
  generateFrontmatterAdditionalInformation() {
    return 'address: ""\n';
  }
  generateTemplate() {
    let response = this.getRpgManagerCodeblock("location");
    response += this.getAdditionalInformation();
    return response;
  }
  generateFrontmatterRelationships() {
    return " locations: \n";
  }
};
var LocationModal = class extends AbstractTemplateModal {
  content(contentEl) {
    this.campaignBlock(contentEl);
  }
};

// src/views/templates/ClueTemplate.ts
var ClueTemplate = class extends AbstractTemplate {
  generateFrontmatterTags() {
    return "tags: [" + this.settings.clueTag + "/" + this.campaignId + "]\n";
  }
  generateFrontmatterSynopsis() {
    return 'synopsis: ""\n';
  }
  generateFrontmatterRelationships() {
    return " characters: \n locations: \n";
  }
  generateFrontmatterDates() {
    return " found: \n";
  }
  generateTemplate() {
    let response = this.getRpgManagerCodeblock("clue");
    response += this.getAdditionalInformation();
    return response;
  }
};
var ClueModal = class extends AbstractTemplateModal {
  content(contentEl) {
    this.campaignBlock(contentEl);
  }
};

// src/views/templates/EventTemplate.ts
var EventTemplate = class extends AbstractTemplate {
  generateFrontmatterTags() {
    return "tags: [" + this.settings.eventTag + "/" + this.campaignId + "]\n";
  }
  generateFrontmatterSynopsis() {
    return 'synopsis: ""\n';
  }
  generateFrontmatterRelationships() {
    return " characters: \n clues: \n locations: \n";
  }
  generateFrontmatterDates() {
    return " event: \n";
  }
  generateTemplate() {
    let response = this.getRpgManagerCodeblock("event");
    response += this.getAdditionalInformation();
    return response;
  }
};
var EventModal = class extends AbstractTemplateModal {
  content(contentEl) {
    this.campaignBlock(contentEl);
  }
};

// src/views/templates/NonPlayerCharacterTemplate.ts
var NonPlayerCharacterTemplate = class extends AbstractTemplate {
  generateFrontmatterTags() {
    return "tags: [" + this.settings.npcTag + "/" + this.campaignId + "]\n";
  }
  generateFrontmatterSynopsis() {
    return 'synopsis: ""\n';
  }
  generateFrontmatterGoals() {
    return 'goals: ""\n';
  }
  generateFrontmatterAdditionalInformation() {
    return "pronoun: #t/s/h\n";
  }
  generateFrontmatterRelationships() {
    return " characters: \n factions: \n locations: \n";
  }
  generateFrontmatterDates() {
    return " dob: \n death: \n";
  }
  generateTemplate() {
    let response = this.getRpgManagerCodeblock("npc");
    response += this.getNotes();
    response += this.getStory();
    return response;
  }
};
var NonPlayerCharacterModal = class extends AbstractTemplateModal {
  content(contentEl) {
    this.campaignBlock(contentEl);
  }
};

// src/views/templates/CharacterTemplate.ts
var CharacterTemplate = class extends AbstractTemplate {
  generateFrontmatterTags() {
    return "tags: [" + this.settings.pcTag + "/" + this.campaignId + "]\n";
  }
  generateFrontmatterRelationships() {
    return " characters: \n factions: \n locations: \n";
  }
  generateFrontmatterDates() {
    return " dob: \n death: \n";
  }
  generateFrontmatterAdditionalInformation() {
    return "pronoun: #t/s/h\n";
  }
  generateTemplate() {
    let response = this.getRpgManagerCodeblock("pc");
    response += this.getPlayerCharacterDetails();
    return response;
  }
};
var CharacterModal = class extends AbstractTemplateModal {
  content(contentEl) {
    this.campaignBlock(contentEl);
  }
};

// src/views/templates/SceneTemplate.ts
var SceneTemplate = class extends AbstractTemplate {
  generateFrontmatterTags() {
    return "tags: [" + this.settings.sceneTag + "/" + this.campaignId + "/" + this.adventureId + "/" + this.sessionId + "/" + this.sceneId + "]\n";
  }
  generateFrontmatterSynopsis() {
    return 'synopsis: ""\n';
  }
  generateFrontmatterAction() {
    return 'action: ""\n';
  }
  generateFrontmatterRelationships() {
    return " clues: \n characters: \n locations: \n";
  }
  generateFrontmatterTimes() {
    return " start: \n end: \n";
  }
  generateTemplate() {
    let response = this.getRpgManagerCodeblock("sceneNavigation");
    response += this.getHeader("Trigger");
    response += "\n\n";
    response += this.getNotes();
    response += this.getRpgManagerCodeblock("scene");
    return response;
  }
};
var SceneModal = class extends AbstractTemplateModal {
  content(contentEl) {
    this.campaignBlock(contentEl);
    this.initialiseAdventures();
    this.adventureBlock(contentEl);
    this.initialiseSessions();
    this.sessionBlock(contentEl);
    this.initialiseScenes();
  }
};

// src/views/templates/SessionTemplate.ts
var SessionTemplate = class extends AbstractTemplate {
  generateFrontmatterTags() {
    return "tags: [" + this.settings.sessionTag + "/" + this.campaignId + "/" + this.adventureId + "/" + this.sessionId + "]\n";
  }
  generateFrontmatterSynopsis() {
    return 'synopsis: ""\n';
  }
  generateFrontmatterDates() {
    return " session: \n irl: \n";
  }
  generateTemplate() {
    let response = this.getRpgManagerCodeblock("sessionNavigation");
    response += this.getHeader("Introduction");
    response += "\n";
    response += this.getHeader("Plot");
    response += this.getHeader("ABT Plot", 3);
    response += this.getAbtPlot();
    response += this.getHeader("Story Circle Plot", 3);
    response += this.getStoryCirclePlot();
    response += this.getRpgManagerCodeblock("session");
    return response;
  }
};
var SessionModal = class extends AbstractTemplateModal {
  content(contentEl) {
    this.campaignBlock(contentEl);
    this.initialiseAdventures();
    this.adventureBlock(contentEl);
    this.initialiseSessions();
  }
};

// src/views/templates/AdventureTemplate.ts
var AdventureTemplate = class extends AbstractTemplate {
  generateFrontmatterTags() {
    return "tags: [" + this.settings.adventureTag + "/" + this.campaignId + "/" + this.adventureId + "]\n";
  }
  generateFrontmatterSynopsis() {
    return 'synopsis: ""\n';
  }
  generateTemplate() {
    let response = this.getHeader("Plot");
    response += this.getAbtPlot();
    response += this.getNotes();
    response += this.getRpgManagerCodeblock("adventure");
    return response;
  }
};
var AdventureModal = class extends AbstractTemplateModal {
  content(contentEl) {
    this.campaignBlock(contentEl);
    this.initialiseAdventures();
  }
};

// src/views/templates/CampaignTemplate.ts
var CampaignTemplate = class extends AbstractTemplate {
  generateFrontmatterTags() {
    return "tags: [" + this.settings.campaignTag + "/" + this.campaignId + "]\n";
  }
  generateFrontmatterDates() {
    return " current: \n";
  }
  generateTemplate() {
    let response = this.getRpgManagerCodeblock("campaignNavigation");
    response += this.getHeader("Plot");
    response += this.getAbtPlot();
    response += this.getRpgManagerCodeblock("campaign");
    return response;
  }
};
var CampaignModal = class extends AbstractTemplateModal {
  content(contentEl) {
  }
};

// src/factories/FileFactory.ts
var import_obsidian2 = require("obsidian");
var FileFactory = class {
  constructor(api) {
    this.api = api;
  }
  initialise(type, create = true) {
    return __async(this, null, function* () {
      var _a;
      let name = null;
      if (create === false) {
        name = (_a = this.api.app.workspace.getActiveFile()) == null ? void 0 : _a.basename;
      }
      new templates_exports[DataType[type] + "Modal"](this.api, type, create, name).open();
    });
  }
  create(type, create, name, campaignId, adventureId = null, sessionId = null, sceneId = null) {
    return __async(this, null, function* () {
      const template = new templates_exports[DataType[type] + "Template"](this.api.settings, name, campaignId, adventureId, sessionId, sceneId);
      const data = template.generateData();
      if (create) {
        const newFile = yield this.api.app.vault.create(name + ".md", data);
        const leaf = this.api.app.workspace.getLeaf(true);
        yield leaf.openFile(newFile);
      } else {
        const activeView = this.api.app.workspace.getActiveViewOfType(import_obsidian2.MarkdownView);
        if (activeView != null) {
          const editor = activeView.editor;
          editor.setValue(data + "\n" + editor.getValue());
        }
      }
    });
  }
  silentCreate(type, name, campaignId, adventureId = null, sessionId = null, sceneId = null) {
    return __async(this, null, function* () {
      const template = new templates_exports[DataType[type] + "Template"](this.api.settings, name, campaignId, adventureId, sessionId, sceneId);
      const data = template.generateData();
      const newFile = yield this.api.app.vault.create(name + ".md", data);
      const leaf = this.api.app.workspace.getLeaf(true);
      yield leaf.openFile(newFile);
    });
  }
};

// src/api.ts
var Api = class extends import_obsidian3.Component {
  constructor(app, settings) {
    super();
    this.app = app;
    this.settings = settings;
    this.initialiseRoots();
    this.fileFactory = new FileFactory(this);
  }
  initialiseRoots() {
    if (this.app.vault.getFiles().length !== 0) {
      const filePath = this.app.vault.getFiles()[0].path;
      let slashCount = 0;
      let p = filePath.indexOf("/");
      while (p !== -1) {
        slashCount++;
        p = filePath.indexOf("/", p + 1);
      }
      slashCount++;
      const file = this.app.vault.getAbstractFileByPath(filePath);
      if (file instanceof import_obsidian3.TFile) {
        this.root = this.app.vault.getResourcePath(file);
      }
      if (this.root === null) {
        console.log("Rpg Manager failed to find the root folder!");
        return;
      }
      if (this.root.includes("?")) {
        this.root = this.root.substring(0, this.root.lastIndexOf("?"));
      }
      for (let removedSlash = slashCount; removedSlash > 0; removedSlash--) {
        this.root = this.root.slice(0, this.root.lastIndexOf("/"));
      }
      if (!this.root.endsWith("/")) {
        this.root += "/";
      }
      this.attachmentRoot = this.root + this.app.vault.config.attachmentFolderPath + "/";
    }
  }
  fileExists(path) {
    const abstractFile = this.app.vault.getAbstractFileByPath(path);
    let response = false;
    if (abstractFile instanceof import_obsidian3.TAbstractFile) {
      response = abstractFile ? true : false;
    }
    return response;
  }
  getImageLink(page) {
    const imageExtensions = ["jpeg", "jpg", "png", "webp"];
    for (let extensionCount = 0; extensionCount < imageExtensions.length; extensionCount++) {
      const fileName = this.app.vault.config.attachmentFolderPath + "/" + (page == null ? void 0 : page.file.name) + "." + imageExtensions[extensionCount];
      if (this.fileExists(fileName)) {
        if (this.root == null) {
          this.initialiseRoots();
        }
        return this.root + fileName;
      }
    }
    return null;
  }
  getImageElement(page, width = 75, height = 75) {
    let imageFile = null;
    if (page !== void 0) {
      imageFile = this.getImageLink(page);
    }
    if (imageFile === null) {
      return null;
    }
    if (width !== 75 && height === 75) {
      height = void 0;
    } else if (width === 75 && height !== 75) {
      width = void 0;
    }
    const response = new Image(width, height);
    response.src = imageFile;
    response.style.objectFit = "cover";
    return response;
  }
  getImage(page, width = 75, height = 75) {
    let imageFile = null;
    if (page !== void 0) {
      imageFile = this.getImageLink(page);
    }
    let minimalDimensions = false;
    let dimensions = "width: " + width + "px; height: " + height + "px;";
    if (width !== 75 && height === 75) {
      dimensions = "width: " + width + "px;";
    } else if (width === 75 && height !== 75) {
      dimensions = "height: " + height + "px;";
    } else if (width === 75 && height === 75) {
      minimalDimensions = true;
    }
    if (imageFile === null) {
      if (!minimalDimensions) {
        return "";
      } else {
        return '<div style="' + dimensions + '"></div>';
      }
    }
    return '<img src="' + imageFile + '" style="object-fit: cover;' + dimensions + '">';
  }
  getTagId(tags, type) {
    if (tags == null) {
      throw new Error();
    }
    let response = "";
    tags.forEach((tag) => {
      if (response === "") {
        if (tag.startsWith(this.settings.campaignTag)) {
          if (type === 0 /* Campaign */) {
            response = tag.substring(this.settings.campaignTag.length + 1);
          } else {
            throw new Error();
          }
        } else if (tag.startsWith(this.settings.adventureTag)) {
          const parts = tag.substring(this.settings.adventureTag.length + 1).split("/");
          if (parts.length === 2) {
            if (type === 0 /* Campaign */) {
              response = parts[0];
            } else if (type === 1 /* Adventure */) {
              response = parts[1];
            }
          } else if (parts.length === 1 && type === 1 /* Adventure */) {
            response = parts[0];
          }
        } else if (tag.startsWith(this.settings.sessionTag)) {
          const parts = tag.substring(this.settings.sessionTag.length + 1).split("/");
          if (parts.length === 3) {
            if (type === 0 /* Campaign */) {
              response = parts[0];
            } else if (type === 1 /* Adventure */) {
              response = parts[1];
            } else if (type === 2 /* Session */) {
              response = parts[2];
            }
          } else if (parts.length === 2) {
            if (type === 1 /* Adventure */) {
              response = parts[0];
            } else if (type === 2 /* Session */) {
              response = parts[1];
            }
          }
        } else if (tag.startsWith(this.settings.sceneTag)) {
          const parts = tag.substring(this.settings.sceneTag.length + 1).split("/");
          if (parts.length === 4) {
            if (type === 0 /* Campaign */) {
              response = parts[0];
            } else if (type === 1 /* Adventure */) {
              response = parts[1];
            } else if (type === 2 /* Session */) {
              response = parts[2];
            } else if (type === 3 /* Scene */) {
              response = parts[3];
            }
          } else if (parts.length === 3) {
            if (type === 1 /* Adventure */) {
              response = parts[0];
            } else if (type === 2 /* Session */) {
              response = parts[1];
            } else if (type === 3 /* Scene */) {
              response = parts[2];
            }
          }
        } else {
          let tagLength = 0;
          if (tag.startsWith(this.settings.npcTag)) {
            tagLength = this.settings.npcTag.length;
          } else if (tag.startsWith(this.settings.pcTag)) {
            tagLength = this.settings.pcTag.length;
          } else if (tag.startsWith(this.settings.eventTag)) {
            tagLength = this.settings.eventTag.length;
          } else if (tag.startsWith(this.settings.factionTag)) {
            tagLength = this.settings.factionTag.length;
          } else if (tag.startsWith(this.settings.locationTag)) {
            tagLength = this.settings.locationTag.length;
          } else if (tag.startsWith(this.settings.clueTag)) {
            tagLength = this.settings.clueTag.length;
          } else if (tag.startsWith(this.settings.timelineTag)) {
            tagLength = this.settings.timelineTag.length;
          }
          if (tagLength !== 0 && tag.length > tagLength && type === 0 /* Campaign */) {
            response = tag.substring(tagLength + 1);
          }
        }
      }
    });
    if (response === "") {
      throw new Error();
    }
    return +response;
  }
  formatDate(date, type = null) {
    if (!date || date === void 0)
      return "";
    let options = null;
    if (type === "long") {
      options = {
        day: "numeric",
        month: "long",
        year: "numeric"
      };
      return date.toLocaleString(options);
    }
    if (type === "short") {
      options = {
        weekday: "short",
        month: "short",
        day: "numeric",
        year: "numeric"
      };
    }
    if (options !== null) {
      return date.toLocaleString(options);
    } else {
      return date.toISODate();
    }
  }
  formatTime(date) {
    if (!date || date === void 0)
      return "";
    const options = {
      hour12: false,
      hour: "2-digit",
      minute: "2-digit"
    };
    return date.toLocaleString(options);
  }
  calculateDuration(start, end) {
    if (!start || !end)
      return "";
    const dtStart = new Date(start);
    const dtEnd = new Date(end);
    const difference = dtEnd.valueOf() - dtStart.valueOf();
    const minutes = difference / 6e4;
    const remaining = difference - minutes * 6e4;
    const seconds = remaining > 0 ? remaining / 1e3 : 0;
    return minutes + ":" + (seconds < 10 ? "0" + seconds : seconds);
  }
  getDeathStatus(page) {
    return page.dates.death !== null ? "<br/>_(Deceased " + this.formatDate(page.dates.death) + ")_ " : "";
  }
  calculateAge(page, currentDate) {
    if (page === void 0)
      return "";
    if (!(page == null ? void 0 : page.dates.dob))
      return "";
    const end = page.dates.death || currentDate;
    const startDate = new Date(page.dates.dob);
    const endDate = new Date(end);
    const ageDifMs = endDate.valueOf() - startDate.valueOf();
    const ageDate = new Date(ageDifMs);
    return Math.abs(ageDate.getUTCFullYear() - 1970).toString();
  }
};

// src/models/index.ts
var models_exports = {};
__export(models_exports, {
  AdventureModel: () => AdventureModel,
  CampaignModel: () => CampaignModel,
  CampaignNavigationModel: () => CampaignNavigationModel,
  ClueModel: () => ClueModel,
  ErrorModel: () => ErrorModel,
  EventModel: () => EventModel,
  FactionModel: () => FactionModel,
  LocationModel: () => LocationModel,
  NotesModel: () => NotesModel,
  NpcModel: () => NpcModel,
  PcModel: () => PcModel,
  SceneModel: () => SceneModel,
  SceneNavigationModel: () => SceneNavigationModel,
  SessionModel: () => SessionModel,
  SessionNavigationModel: () => SessionNavigationModel,
  TimelineModel: () => TimelineModel
});

// src/abstracts/AbstractModel.ts
var import_obsidian6 = require("obsidian");

// src/views/index.ts
var views_exports = {};
__export(views_exports, {
  AdventureListView: () => AdventureListView,
  CampaignNavigationView: () => CampaignNavigationView,
  CharacterInfoView: () => CharacterInfoView,
  CharacterListView: () => CharacterListView,
  ClueListView: () => ClueListView,
  ClueStatusView: () => ClueStatusView,
  EventListView: () => EventListView,
  FactionListView: () => FactionListView,
  ImageView: () => ImageView,
  LocationListView: () => LocationListView,
  SceneActionView: () => SceneActionView,
  SceneListView: () => SceneListView,
  SceneNavigationView: () => SceneNavigationView,
  SessionListView: () => SessionListView,
  SessionNavigatorView: () => SessionNavigatorView,
  SynopsisView: () => SynopsisView,
  TimelineView: () => TimelineView
});

// src/abstracts/AbstractSingleView.ts
var AbstractSingleView = class {
  constructor(api, dv) {
    this.api = api;
    this.dv = dv;
    this.container = dv.container;
  }
  spacer() {
    this.dv.span('<div style="height: 20px"></div>');
  }
};

// src/views/SessionNavigatorView.ts
var SessionNavigatorView = class extends AbstractSingleView {
  render(data) {
    return __async(this, null, function* () {
      const tableElements = [];
      tableElements.push(["Adventure", data.adventure ? data.adventure.link : ""]);
      if (data.previousSession != null) {
        tableElements.push(["<< Previous Session", data.previousSession.link]);
      }
      if (data.nextSession != null) {
        tableElements.push(["Next Session >>", data.nextSession.link]);
      }
      const table = this.dv.markdownTable(["Campaign", "" + data.campaign.link], tableElements);
      this.dv.paragraph(table);
      this.spacer();
    });
  }
};

// src/views/SceneNavigationView.ts
var SceneNavigationView = class extends AbstractSingleView {
  render(data) {
    return __async(this, null, function* () {
      const tableElements = [];
      tableElements.push(["Adventure", data.adventure != void 0 ? data.adventure.link : ""]);
      tableElements.push(["Session", data.session != void 0 ? data.session.link : ""]);
      if (data.previousScene != void 0) {
        tableElements.push(["<< Previous Scene", data.previousScene.link]);
      }
      if (data.nextScene != void 0) {
        tableElements.push(["Next Scene >>", data.nextScene.link]);
      }
      const table = this.dv.markdownTable(["Campaign", "" + data.campaign.link], tableElements);
      this.dv.paragraph(table);
      this.spacer();
    });
  }
};

// src/abstracts/AbstractListView.ts
var AbstractListView = class {
  constructor(api, dv) {
    this.api = api;
    this.dv = dv;
    this.container = dv.container;
  }
  spacer() {
    this.dv.span('<div style="height: 20px"></div>');
  }
};

// src/views/Lists/FactionListView.ts
var FactionListView = class extends AbstractListView {
  render(data) {
    return __async(this, null, function* () {
      this.dv.span("## Factions");
      this.dv.table(["", "Faction", "Synopsis"], data.elements.map((clue) => [
        clue.image,
        clue.link,
        clue.synopsis
      ]));
      this.spacer();
    });
  }
};

// src/views/CharacterInfoView.ts
var CharacterInfoView = class extends AbstractSingleView {
  render(data) {
    return __async(this, null, function* () {
      this.dv.table(["**" + data.name + "**", ""], [
        ["Status", data.isDead ? "Dead" : "Alive"],
        ["Pronoun", data.pronoun != null ? PronounFactory.read(data.pronoun) : '<span class="rpgm-missing">pronoun missing in frontmatter</span>'],
        [data.isDead ? "Age at Death" : "Age", data.age !== "" ? data.age : '<span class="rpgm-missing">Dob or campaign date missing</span>'],
        ["Goals", data.goals ? data.goals : '<span class="rpgm-missing">Goals missing</span>']
      ]);
      this.spacer();
    });
  }
};

// src/views/Lists/ClueListView.ts
var ClueListView = class extends AbstractListView {
  render(data) {
    return __async(this, null, function* () {
      this.dv.span("## Clues");
      this.dv.table(["", "Clue", "Found", "Synopsis"], data.elements.map((clue) => [
        clue.image,
        clue.link,
        clue.found === false ? '<span class="rpgm-missing">no</span>' : clue.found,
        clue.synopsis
      ]));
      this.spacer();
    });
  }
};

// src/views/Lists/EventListView.ts
var EventListView = class extends AbstractListView {
  render(data) {
    return __async(this, null, function* () {
      this.dv.span("## Events");
      this.dv.table(["", "Name", "Date", "Synopsis"], data.elements.map((event) => [
        event.image,
        event.link,
        event.date,
        event.synopsis
      ]));
      this.spacer();
    });
  }
};

// src/views/SynopsisView.ts
var SynopsisView = class extends AbstractSingleView {
  render(data) {
    return __async(this, null, function* () {
      if (data.death !== "") {
        this.dv.span("_Deceased " + data.death + "_<br/>");
      }
      if (data.title !== null) {
        this.dv.span("## " + data.title);
      }
      let response = "";
      if (data.synopsis !== "") {
        if (data.isCharacter) {
          response = data.link + (data.pronoun != null ? " (" + PronounFactory.read(data.pronoun) + ")" : "") + (data.death !== "" ? " was " : " is ") + data.synopsis;
        } else {
          response = data.synopsis;
        }
      } else {
        response = '<span class="rpgm-missing">Synopsis missing</span>';
      }
      this.dv.span(response);
      this.spacer();
    });
  }
};

// src/views/ImageView.ts
var ImageView = class extends AbstractSingleView {
  render(data) {
    return __async(this, null, function* () {
      if (data.image !== "") {
        this.dv.span(data.image);
        this.spacer();
      }
    });
  }
};

// src/views/ClueStatusView.ts
var ClueStatusView = class extends AbstractSingleView {
  render(data) {
    return __async(this, null, function* () {
      this.dv.span((data.found === false ? "==Clue **NOT** found by the player characters==" : "_clue found by the player characters on " + data.found + "_") + "<br/>&nbsp;<br/>");
    });
  }
};

// src/views/Lists/SessionListView.ts
var SessionListView = class extends AbstractListView {
  render(data) {
    return __async(this, null, function* () {
      this.dv.span("## Sessions");
      this.dv.table(["&#35;", "Session", "Synopsis", "Date", "Play Date"], data.elements.map((session) => [
        session.id,
        session.link,
        session.synopsis,
        session.date,
        session.irl
      ]));
      this.spacer();
    });
  }
};

// src/views/Lists/AdventureListView.ts
var AdventureListView = class extends AbstractListView {
  render(data) {
    return __async(this, null, function* () {
      this.dv.span("## Adventures");
      this.dv.table(["", "Adventure", "Synopsis"], data.elements.map((adventure) => [
        adventure.id,
        adventure.link,
        adventure.synopsis
      ]));
      this.spacer();
    });
  }
};

// src/views/TimelineView.ts
var import_obsidian4 = require("obsidian");
var TimelineView = class extends AbstractListView {
  render(data) {
    return __async(this, null, function* () {
      var _a, _b;
      const container = this.dv.container.createDiv({ cls: "rpg-container" });
      const header = container.createDiv({ cls: "rpgm-header" });
      if (((_a = data.campaign) == null ? void 0 : _a.imageSrc) !== null) {
        header.style.backgroundImage = "url('" + ((_b = data.campaign) == null ? void 0 : _b.imageSrc) + "')";
      }
      const overlay = header.createDiv({ cls: "rpgm-header-overlay" });
      overlay.createDiv({ cls: "rpgm-header-title", text: "Timeline" });
      overlay.createDiv({ cls: "rpgm-campaign-name", text: data.campaign !== null ? data.campaign.name : "Campaign" });
      overlay.createDiv({ cls: "rpgm-current-date", text: data.campaign !== null ? this.api.formatDate(data.campaign.currentDate, "long") : "" });
      const timeline = container.createDiv({ cls: "rpgm-timeline" });
      const ul = timeline.createEl("ul");
      data.elements.forEach((timeline2) => {
        const li = ul.createEl("li");
        const timeContainer = li.createDiv({ cls: "event-time-container" });
        timeContainer.createDiv({ cls: "event-time", text: timeline2.date + (timeline2.time !== "00:00" ? "<br/>" + timeline2.time : "") });
        const type = timeContainer.createDiv({ cls: "event-type", text: timeline2.type });
        if (timeline2.getEventColour() !== "") {
          type.addClass(timeline2.getEventColour());
        }
        const bullet = li.createDiv({ cls: "bullet" });
        if (timeline2.getEventColour() !== "") {
          bullet.addClass(timeline2.getEventColour());
        }
        const details = li.createDiv({ cls: "event-details" });
        const fileLink = details.createEl("h3");
        const synopsis = details.createSpan();
        import_obsidian4.MarkdownRenderer.renderMarkdown(timeline2.synopsis, synopsis, this.dv.currentFilePath, null);
        import_obsidian4.MarkdownRenderer.renderMarkdown("[[" + timeline2.name + "]]", fileLink, this.dv.currentFilePath, null);
      });
    });
  }
};

// src/views/Lists/CharacterListView.ts
var CharacterListView = class extends AbstractListView {
  render(data) {
    return __async(this, null, function* () {
      this.dv.span("## Characters");
      this.dv.table(["", "Name", "Age", "Synopsis"], data.elements.map((character) => [
        character.image,
        character.link,
        character.age,
        character.synopsis
      ]));
      this.spacer();
    });
  }
};

// src/views/Lists/LocationListView.ts
var LocationListView = class extends AbstractListView {
  render(data, title = null) {
    return __async(this, null, function* () {
      this.dv.span("## " + (title == null ? "Locations" : title));
      this.dv.table(["", "Name", "Synopsis"], data.elements.map((character) => [
        character.image,
        character.link,
        character.synopsis
      ]));
      this.spacer();
    });
  }
};

// src/views/Lists/SceneListView.ts
var SceneListView = class extends AbstractListView {
  render(data) {
    return __async(this, null, function* () {
      this.dv.span("## Sessions");
      this.dv.table(["&#35;", "Scene", "Synopsis", "Start", "End", "Duration"], data.elements.map((scene) => [
        scene.completed ? scene.id : "**" + scene.id + "**",
        scene.link + (scene.completed ? "" : " (*to complete*)"),
        scene.synopsis,
        scene.startTime,
        scene.endTime,
        scene.duration
      ]));
      this.dv.container.createEl("a", { cls: "rpgm-button", text: "Add new scene", href: "#" }).addEventListener("click", (e) => {
        this.createNewScene();
      });
      this.spacer();
    });
  }
  createNewScene() {
    return __async(this, null, function* () {
      const current = this.dv.current();
      if (current != null) {
        let campaignId = null;
        let adventureId = null;
        let sessionId = null;
        current.tags.forEach((tag) => {
          if (tag.startsWith(this.api.settings.sessionTag)) {
            const ids = tag.substring(this.api.settings.sessionTag.length + 1).split("/");
            campaignId = +ids[0];
            adventureId = +ids[1];
            sessionId = +ids[2];
          }
        });
        if (campaignId != null && adventureId != null && sessionId != null) {
          let sceneId = 1;
          this.dv.pages("#" + this.api.settings.sceneTag + "/" + campaignId + "/" + adventureId + "/" + sessionId).forEach((page) => {
            page.tags.forEach((tag) => {
              if (tag.startsWith(this.api.settings.sceneTag)) {
                const currentScene = +tag.substring(tag.lastIndexOf("/") + 1);
                if (currentScene >= sceneId) {
                  sceneId = currentScene + 1;
                }
              }
            });
          });
          const sessionIdText = sessionId < 10 ? "0" + sessionId : sessionId;
          const sceneIdText = sceneId < 10 ? "0" + sceneId : sceneId;
          this.api.fileFactory.silentCreate(3 /* Scene */, "s" + sessionIdText + "e" + sceneIdText, campaignId, adventureId, sessionId, sceneId);
        }
      }
    });
  }
};

// src/views/SceneActionView.ts
var import_obsidian5 = require("obsidian");
var SceneActionView = class extends AbstractSingleView {
  render(data) {
    return __async(this, null, function* () {
      const goalDiv = this.container.createDiv();
      goalDiv.addClass("rpgm-scene-goal");
      const goalTitle = goalDiv.createDiv();
      goalTitle.addClass("title");
      goalTitle.innerText = "Scene Goal";
      import_obsidian5.MarkdownRenderer.renderMarkdown(data.synopsis !== "" ? data.synopsis : '<span class="rpgm-missing">Missing Scene Synopsis (Goal)</span>', goalDiv, this.dv.currentFilePath, null);
      const actionDiv = this.container.createDiv();
      actionDiv.addClass("rpgm-scene-action");
      const actionTitle = actionDiv.createDiv();
      actionTitle.addClass("title");
      actionTitle.innerText = "Player Character's Action";
      import_obsidian5.MarkdownRenderer.renderMarkdown(data.action !== "" ? data.action : '<span class="rpgm-missing">Missing Scene Action</span>', actionDiv, this.dv.currentFilePath, null);
    });
  }
};

// src/views/CampaignNavigationView.ts
var CampaignNavigationView = class extends AbstractSingleView {
  render(data) {
    return __async(this, null, function* () {
      if (data.imageSrc !== null) {
        const container = this.dv.container.createDiv({ cls: "rpg-container" });
        const header = container.createDiv({ cls: "rpgm-header" });
        header.style.backgroundImage = "url('" + data.imageSrc + "')";
        const overlay = header.createDiv({ cls: "rpgm-header-overlay" });
        overlay.createDiv({ cls: "rpgm-header-title", text: data.name });
      } else {
        this.dv.container.createEl("h1", { text: data.name });
      }
    });
  }
};

// src/factories/RpgViewFactory.ts
var viewType = /* @__PURE__ */ ((viewType2) => {
  viewType2[viewType2["AdventureList"] = 0] = "AdventureList";
  viewType2[viewType2["CharacterList"] = 1] = "CharacterList";
  viewType2[viewType2["Timeline"] = 2] = "Timeline";
  viewType2[viewType2["SessionList"] = 3] = "SessionList";
  viewType2[viewType2["ClueStatus"] = 4] = "ClueStatus";
  viewType2[viewType2["Image"] = 5] = "Image";
  viewType2[viewType2["Synopsis"] = 6] = "Synopsis";
  viewType2[viewType2["ClueRelationshipList"] = 7] = "ClueRelationshipList";
  viewType2[viewType2["LocationList"] = 8] = "LocationList";
  viewType2[viewType2["EventList"] = 9] = "EventList";
  viewType2[viewType2["ClueList"] = 10] = "ClueList";
  viewType2[viewType2["CharacterInfo"] = 11] = "CharacterInfo";
  viewType2[viewType2["FactionList"] = 12] = "FactionList";
  viewType2[viewType2["SessionNavigator"] = 13] = "SessionNavigator";
  viewType2[viewType2["SceneList"] = 14] = "SceneList";
  viewType2[viewType2["SceneNavigation"] = 15] = "SceneNavigation";
  viewType2[viewType2["SceneAction"] = 16] = "SceneAction";
  viewType2[viewType2["CampaignNavigation"] = 17] = "CampaignNavigation";
  return viewType2;
})(viewType || {});
var RpgViewFactory = class {
  static initialise(api) {
    this.api = api;
  }
  static createList(viewName, dv) {
    return new views_exports[viewType[viewName] + "View"](this.api, dv);
  }
  static createSingle(viewName, dv) {
    return new views_exports[viewType[viewName] + "View"](this.api, dv);
  }
};

// src/abstracts/AbstractModel.ts
var AbstractModel = class extends import_obsidian6.MarkdownRenderChild {
  constructor(api, container, source, component, sourcePath) {
    super(container);
    this.api = api;
    this.container = container;
    this.source = source;
    this.component = component;
    this.sourcePath = sourcePath;
    this.redrawContainer = () => {
      if (this.isActivePage()) {
        this.renderComponent();
      }
    };
  }
  renderComponent(wait = 500) {
    return __async(this, null, function* () {
      setTimeout(() => {
        let continueRendering = true;
        this.dv = this.api.app.plugins.plugins.dataview.localApi(this.sourcePath, this.component, this.container);
        const current = this.dv.current();
        if (current != null) {
          this.current = current;
        } else {
          continueRendering = false;
        }
        if (continueRendering) {
          try {
            const campaignId = this.api.getTagId(this.current.tags, 0 /* Campaign */);
            const campaigns = this.dv.pages("#" + this.api.settings.campaignTag + "/" + campaignId);
            if (campaigns.length !== 1) {
              continueRendering = false;
            }
            if (continueRendering) {
              this.campaign = new CampaignData(this.api, campaigns[0]);
            }
          } catch (e) {
            continueRendering = false;
          }
        }
        if (continueRendering) {
          this.io = new IoData(this.api, this.campaign, this.dv, this.current);
          this.container.empty();
          this.render();
        }
      }, wait);
    });
  }
  onload() {
    this.renderComponent(0);
    this.registerEvent(this.api.app.workspace.on("rpgmanager:refresh-views", this.redrawContainer));
  }
  isActivePage() {
    var _a, _b, _c, _d;
    const views = this.api.app.workspace.getLayout().main.children;
    for (let viewCounter = 0; viewCounter < views.length; viewCounter++) {
      if (((_b = (_a = views[viewCounter].state) == null ? void 0 : _a.state) == null ? void 0 : _b.file) !== void 0 && ((_d = (_c = views[viewCounter].state) == null ? void 0 : _c.state) == null ? void 0 : _d.file) === this.sourcePath) {
        return true;
      }
    }
    return false;
  }
  writeList(data, typeOfView, title = null) {
    if (data.elements.length > 0) {
      const view = RpgViewFactory.createList(typeOfView, this.dv);
      view.render(data, title);
    }
  }
  writeData(data, typeOfView) {
    const view = RpgViewFactory.createSingle(typeOfView, this.dv);
    view.render(data);
  }
  image(width = 75, height = 75) {
    this.writeData(this.io.getImage(width, height), 5 /* Image */);
  }
  synopsis(title = null) {
    this.writeData(this.io.getSynopsis(title), 6 /* Synopsis */);
  }
};

// src/models/AdventureModel.ts
var AdventureModel = class extends AbstractModel {
  render() {
    return __async(this, null, function* () {
      const adventure = new AdventureData(this.api, this.current, this.campaign);
      this.sessionList(adventure.id);
    });
  }
  sessionList(adventureId) {
    return __async(this, null, function* () {
      this.writeList(this.io.getSessionList(adventureId), 3 /* SessionList */);
    });
  }
};

// src/models/CampaignModel.ts
var CampaignModel = class extends AbstractModel {
  render() {
    return __async(this, null, function* () {
      this.adventureList();
      this.sessionList();
      this.characterList();
    });
  }
  adventureList() {
    return __async(this, null, function* () {
      this.writeList(this.io.getAdventureList(), 0 /* AdventureList */);
    });
  }
  sessionList() {
    return __async(this, null, function* () {
      this.writeList(this.io.getSessionList(), 3 /* SessionList */);
    });
  }
  characterList() {
    return __async(this, null, function* () {
      this.writeList(this.io.getCharacterList(), 1 /* CharacterList */);
    });
  }
};

// src/models/ClueModel.ts
var ClueModel = class extends AbstractModel {
  render() {
    return __async(this, null, function* () {
      this.status();
      this.image(450);
      this.synopsis();
      this.characterList();
      this.locationList();
      this.eventList();
    });
  }
  status() {
    this.writeData(this.io.getClue(), 4 /* ClueStatus */);
  }
  characterList() {
    return __async(this, null, function* () {
      this.writeList(this.io.getRelationshipList(4 /* Character */), 1 /* CharacterList */);
    });
  }
  locationList() {
    return __async(this, null, function* () {
      this.writeList(this.io.getRelationshipList(6 /* Location */), 8 /* LocationList */);
    });
  }
  eventList() {
    return __async(this, null, function* () {
      this.writeList(this.io.getRelationshipList(7 /* Event */, 8 /* Clue */), 9 /* EventList */);
    });
  }
};

// src/models/ErrorModel.ts
var ErrorModel = class extends AbstractModel {
  render() {
    return __async(this, null, function* () {
      this.container.innerText = "The selected function does not exist in Rpg Manager";
    });
  }
};

// src/models/EventModel.ts
var EventModel = class extends AbstractModel {
  render() {
    return __async(this, null, function* () {
      this.image(450);
      this.synopsis();
      this.characterList();
      this.clueList();
      this.locationList();
    });
  }
  characterList() {
    return __async(this, null, function* () {
      this.writeList(this.io.getRelationshipList(4 /* Character */), 1 /* CharacterList */);
    });
  }
  clueList() {
    return __async(this, null, function* () {
      this.writeList(this.io.getRelationshipList(8 /* Clue */), 10 /* ClueList */);
    });
  }
  locationList() {
    return __async(this, null, function* () {
      this.writeList(this.io.getRelationshipList(6 /* Location */), 8 /* LocationList */);
    });
  }
};

// src/models/FactionModel.ts
var FactionModel = class extends AbstractModel {
  render() {
    return __async(this, null, function* () {
      this.synopsis();
      this.image(200);
      this.characterList();
      this.locationList();
    });
  }
  characterList() {
    return __async(this, null, function* () {
      this.writeList(this.io.getRelationshipList(4 /* Character */, 9 /* Faction */), 1 /* CharacterList */);
    });
  }
  locationList() {
    return __async(this, null, function* () {
      this.writeList(this.io.getRelationshipList(6 /* Location */), 8 /* LocationList */);
    });
  }
};

// src/models/LocationModel.ts
var LocationModel = class extends AbstractModel {
  render() {
    return __async(this, null, function* () {
      var _a, _b;
      this.synopsis(((_a = this.dv.current()) == null ? void 0 : _a.address) ? (_b = this.dv.current()) == null ? void 0 : _b.address : null);
      this.image(450);
      this.characterList();
      this.eventList();
      this.clueList();
      this.locationList();
      this.parentLocationList();
    });
  }
  characterList() {
    return __async(this, null, function* () {
      this.writeList(this.io.getRelationshipList(4 /* Character */, 6 /* Location */), 1 /* CharacterList */);
    });
  }
  eventList() {
    return __async(this, null, function* () {
      this.writeList(this.io.getRelationshipList(7 /* Event */, 6 /* Location */), 9 /* EventList */);
    });
  }
  clueList() {
    return __async(this, null, function* () {
      this.writeList(this.io.getRelationshipList(8 /* Clue */, 6 /* Location */), 10 /* ClueList */);
    });
  }
  locationList() {
    return __async(this, null, function* () {
      this.writeList(this.io.getRelationshipList(6 /* Location */), 8 /* LocationList */, "Sub-locations");
    });
  }
  parentLocationList() {
    return __async(this, null, function* () {
      this.writeList(this.io.getRelationshipList(6 /* Location */, 6 /* Location */), 8 /* LocationList */, "Part of");
    });
  }
};

// src/models/NotesModel.ts
var NotesModel = class extends AbstractModel {
  render() {
    return __async(this, null, function* () {
    });
  }
};

// src/models/NpcModel.ts
var NpcModel = class extends AbstractModel {
  render() {
    return __async(this, null, function* () {
      this.synopsis();
      this.image(300, 300);
      this.info();
      this.factionList();
      this.characterList();
      this.eventList();
      this.clueList();
      this.locationList();
    });
  }
  info() {
    return __async(this, null, function* () {
      const current = this.dv.current();
      if (current !== void 0) {
        const data = new CharacterData(this.api, current, this.campaign);
        const view = RpgViewFactory.createSingle(11 /* CharacterInfo */, this.dv);
        view.render(data);
      }
    });
  }
  factionList() {
    return __async(this, null, function* () {
      this.writeList(this.io.getRelationshipList(9 /* Faction */), 12 /* FactionList */);
    });
  }
  characterList() {
    return __async(this, null, function* () {
      this.writeList(this.io.getRelationshipList(4 /* Character */), 1 /* CharacterList */);
    });
  }
  eventList() {
    return __async(this, null, function* () {
      this.writeList(this.io.getRelationshipList(7 /* Event */, 4 /* Character */), 9 /* EventList */);
    });
  }
  clueList() {
    return __async(this, null, function* () {
      this.writeList(this.io.getRelationshipList(8 /* Clue */, 4 /* Character */), 10 /* ClueList */);
    });
  }
  locationList() {
    return __async(this, null, function* () {
      this.writeList(this.io.getRelationshipList(6 /* Location */), 8 /* LocationList */);
    });
  }
};

// src/models/PcModel.ts
var PcModel = class extends AbstractModel {
  render() {
    return __async(this, null, function* () {
      this.synopsis();
      this.image(300, 300);
      this.factionList();
      this.characterList();
      this.locationList();
    });
  }
  factionList() {
    return __async(this, null, function* () {
      this.writeList(this.io.getRelationshipList(9 /* Faction */), 12 /* FactionList */);
    });
  }
  characterList() {
    return __async(this, null, function* () {
      this.writeList(this.io.getRelationshipList(4 /* Character */), 1 /* CharacterList */);
    });
  }
  locationList() {
    return __async(this, null, function* () {
      this.writeList(this.io.getRelationshipList(6 /* Location */), 8 /* LocationList */);
    });
  }
};

// src/models/SceneModel.ts
var SceneModel = class extends AbstractModel {
  render() {
    return __async(this, null, function* () {
      this.characterList();
      this.locationList();
      this.clueList();
    });
  }
  characterList() {
    return __async(this, null, function* () {
      this.writeList(this.io.getRelationshipList(4 /* Character */), 1 /* CharacterList */);
    });
  }
  locationList() {
    return __async(this, null, function* () {
      this.writeList(this.io.getRelationshipList(6 /* Location */), 8 /* LocationList */);
    });
  }
  clueList() {
    return __async(this, null, function* () {
      this.writeList(this.io.getRelationshipList(8 /* Clue */), 10 /* ClueList */);
    });
  }
};

// src/models/SessionModel.ts
var SessionModel = class extends AbstractModel {
  render() {
    return __async(this, null, function* () {
      this.sceneList();
    });
  }
  sceneList() {
    return __async(this, null, function* () {
      this.writeList(this.io.getSceneList(this.api.getTagId(this.current.tags, 1 /* Adventure */), this.api.getTagId(this.current.tags, 2 /* Session */)), 14 /* SceneList */);
    });
  }
};

// src/models/SessionNavigationModel.ts
var SessionNavigationModel = class extends AbstractModel {
  render() {
    return __async(this, null, function* () {
      this.synopsis();
      this.sessionNavigator();
    });
  }
  sessionNavigator() {
    return __async(this, null, function* () {
      const adventureId = this.api.getTagId(this.current.tags, 1 /* Adventure */);
      const sessionId = this.api.getTagId(this.current.tags, 2 /* Session */);
      const adventure = this.io.getAdventure(adventureId);
      const previousSession = this.io.getSession(null, sessionId - 1);
      const nextSession = this.io.getSession(null, sessionId + 1);
      const data = new SessionData(this.api, this.current, this.campaign, adventure, previousSession, nextSession);
      const view = RpgViewFactory.createSingle(13 /* SessionNavigator */, this.dv);
      view.render(data);
    });
  }
};

// src/models/TimelineModel.ts
var TimelineModel = class extends AbstractModel {
  render() {
    return __async(this, null, function* () {
      var _a;
      const data = new TimelineList(this.campaign);
      let query = "#" + this.api.settings.eventTag + "/" + this.campaign.id;
      const events = this.dv.pages(query).where((event) => {
        var _a2, _b;
        return ((_a2 = event == null ? void 0 : event.dates) == null ? void 0 : _a2.event) !== void 0 && ((_b = event == null ? void 0 : event.dates) == null ? void 0 : _b.event) !== null;
      });
      events.forEach((event) => {
        data.add(new TimelineData(this.api, event, "event"));
      });
      query = "(#" + this.api.settings.npcTag + "/" + this.campaign.id + " or #" + this.api.settings.pcTag + "/" + this.campaign.id + ")";
      let characters = this.dv.pages(query).where((character) => {
        var _a2, _b;
        return ((_a2 = character == null ? void 0 : character.dates) == null ? void 0 : _a2.dob) !== void 0 && ((_b = character == null ? void 0 : character.dates) == null ? void 0 : _b.dob) !== null;
      });
      characters.forEach((character) => {
        data.add(new TimelineData(this.api, character, "birth"));
      });
      characters = this.dv.pages(query).where((character) => {
        var _a2, _b;
        return ((_a2 = character == null ? void 0 : character.dates) == null ? void 0 : _a2.death) !== void 0 && ((_b = character == null ? void 0 : character.dates) == null ? void 0 : _b.death) !== null;
      });
      characters.forEach((character) => {
        data.add(new TimelineData(this.api, character, "death"));
      });
      query = "#" + this.api.settings.sessionTag + "/" + this.campaign.id;
      const sessions = this.dv.pages(query).where((session) => {
        var _a2, _b;
        return ((_a2 = session == null ? void 0 : session.dates) == null ? void 0 : _a2.session) !== void 0 && ((_b = session == null ? void 0 : session.dates) == null ? void 0 : _b.session) !== null;
      });
      sessions.forEach((session) => {
        data.add(new TimelineData(this.api, session, "session"));
      });
      query = "#" + this.api.settings.clueTag + "/" + ((_a = this.campaign) == null ? void 0 : _a.id);
      const clues = this.dv.pages(query).where((clue) => {
        var _a2, _b;
        return ((_a2 = clue == null ? void 0 : clue.dates) == null ? void 0 : _a2.found) !== void 0 && ((_b = clue == null ? void 0 : clue.dates) == null ? void 0 : _b.found) !== null;
      });
      clues.forEach((clue) => {
        data.add(new TimelineData(this.api, clue, "clue"));
      });
      data.sort();
      const view = RpgViewFactory.createList(2 /* Timeline */, this.dv);
      view.render(data, null);
    });
  }
};

// src/models/SceneNavigationModel.ts
var SceneNavigationModel = class extends AbstractModel {
  render() {
    return __async(this, null, function* () {
      this.action();
      this.sceneNavigation();
    });
  }
  action() {
    const scene = this.io.getScene(this.api.getTagId(this.current.tags, 1 /* Adventure */), this.api.getTagId(this.current.tags, 2 /* Session */), this.api.getTagId(this.current.tags, 3 /* Scene */));
    if (scene !== null) {
      this.writeData(scene, 16 /* SceneAction */);
    }
  }
  sceneNavigation() {
    return __async(this, null, function* () {
      const adventureId = this.api.getTagId(this.current.tags, 1 /* Adventure */);
      const sessionId = this.api.getTagId(this.current.tags, 2 /* Session */);
      const sceneId = this.api.getTagId(this.current.tags, 3 /* Scene */);
      const adventure = this.io.getAdventure(adventureId);
      const session = this.io.getSession(adventureId, sessionId);
      const previousScene = this.io.getScene(adventureId, sessionId, sceneId - 1);
      const nextScene = this.io.getScene(adventureId, sessionId, sceneId + 1);
      const data = new SceneData(this.api, this.current, this.campaign, adventure, session, previousScene, nextScene);
      const view = RpgViewFactory.createSingle(15 /* SceneNavigation */, this.dv);
      view.render(data);
    });
  }
};

// src/models/CampaignNavigationModel.ts
var CampaignNavigationModel = class extends AbstractModel {
  render() {
    return __async(this, null, function* () {
      this.campaignNavigation();
    });
  }
  campaignNavigation() {
    return __async(this, null, function* () {
      const data = new CampaignData(this.api, this.current);
      const view = RpgViewFactory.createSingle(17 /* CampaignNavigation */, this.dv);
      view.render(data);
    });
  }
};

// src/factories/RpgModelFactory.ts
var RpgModelFactory = class {
  static initialise(api) {
    this.api = api;
  }
  static create(container, source, component, sourcePath) {
    let modelName = source.replace(/[\n\r]/g, "").toLowerCase();
    modelName = modelName[0].toUpperCase() + modelName.substring(1);
    modelName = modelName.replace("navigation", "Navigation");
    try {
      return new models_exports[modelName + "Model"](this.api, container, source, component, sourcePath);
    } catch (e) {
      return new ErrorModel(this.api, container, source, component, sourcePath);
    }
  }
};

// src/Settings.ts
var import_obsidian7 = require("obsidian");
var DEFAULT_SETTINGS = {
  campaignTag: "rpgm/outline/campaign",
  adventureTag: "rpgm/outline/adventure",
  sessionTag: "rpgm/outline/session",
  sceneTag: "rpgm/outline/scene",
  npcTag: "rpgm/element/character/npc",
  pcTag: "rpgm/element/character/pc",
  locationTag: "rpgm/element/location",
  factionTag: "rpgm/element/faction",
  eventTag: "rpgm/element/event",
  clueTag: "rpgm/element/clue",
  timelineTag: "rpgm/element/timeline",
  noteTag: "rpgm/element/note"
};
var RpgManagerSettingTab = class extends import_obsidian7.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    containerEl.createEl("h2", { text: "Settings for Role Playing Game Manager" });
    containerEl.createEl("h3", { text: "Outlines" });
    containerEl.createEl("span", { text: createFragment((frag) => {
      frag.appendText("Outlines are the plot part of the campaign.");
      frag.createEl("br");
      frag.appendText("The outlines are organised as campaigns > adventures > sessions > scenes");
      frag.createEl("br");
      frag.appendText("Each tag that identifies an outline should be followed by the ids of the parent outlines and end with a unique identifier for the current outline");
      frag.createEl("br");
      frag.createEl("span");
      frag.appendText(" ");
    }) });
    new import_obsidian7.Setting(this.containerEl).setName("Campaign Outline Tag").setDesc(createFragment((frag) => {
      frag.appendText("The tag identifying the campaign");
      frag.createEl("br");
      frag.appendText("Required ids:");
      frag.createEl("br");
      frag.appendText("/{campaignId}");
    })).addText((text) => text.setPlaceholder("rpgm/outline/campaign").setValue(this.plugin.settings.campaignTag).onChange((value) => __async(this, null, function* () {
      if (value.length == 0)
        return;
      yield this.plugin.saveSettings();
    })));
    new import_obsidian7.Setting(this.containerEl).setName("Adventure Outline Tag").setDesc(createFragment((frag) => {
      frag.appendText("The tag identifying an Adventure");
      frag.createEl("br");
      frag.appendText("Required ids:");
      frag.createEl("br");
      frag.appendText("/{campaignId}/{adventureId}");
    })).addText((text) => text.setPlaceholder("rpgm/outline/adventure").setValue(this.plugin.settings.adventureTag).onChange((value) => __async(this, null, function* () {
      if (value.length == 0)
        return;
      yield this.plugin.saveSettings();
    })));
    new import_obsidian7.Setting(this.containerEl).setName("Session Outline Tag").setDesc(createFragment((frag) => {
      frag.appendText("The tag identifying a Session");
      frag.createEl("br");
      frag.appendText("Required ids:");
      frag.createEl("br");
      frag.appendText("/{campaignId}/{adventureId}/{sessionId}");
    })).addText((text) => text.setPlaceholder("rpgm/outline/session").setValue(this.plugin.settings.sessionTag).onChange((value) => __async(this, null, function* () {
      if (value.length == 0)
        return;
      yield this.plugin.saveSettings();
    })));
    new import_obsidian7.Setting(this.containerEl).setName("Scenes Outline Tag").setDesc(createFragment((frag) => {
      frag.appendText("The tag identifying a Scene");
      frag.createEl("br");
      frag.appendText("Required ids:");
      frag.createEl("br");
      frag.appendText("/{campaignId}/{adventureId}/{sessionId}/{sceneId}");
    })).addText((text) => text.setPlaceholder("rpgm/outline/scene").setValue(this.plugin.settings.sceneTag).onChange((value) => __async(this, null, function* () {
      if (value.length == 0)
        return;
      yield this.plugin.saveSettings();
    })));
    containerEl.createEl("h3", { text: "Elements" });
    containerEl.createEl("span", { text: createFragment((frag) => {
      frag.appendText("Elements are all the parts of the campaign which are not a plot.");
      frag.createEl("br");
      frag.appendText("The elements do not have a hyerarchical structure, but they only identify the campaign they belong to.");
      frag.createEl("br");
      frag.appendText("Each tag that identifies an element should be followed by the {campaignId}");
      frag.createEl("br");
      frag.appendText(" ");
    }) });
    new import_obsidian7.Setting(this.containerEl).setName("Player Character Tag").addText((text) => text.setPlaceholder("rpgm/element/character/pc").setValue(this.plugin.settings.pcTag).onChange((value) => __async(this, null, function* () {
      if (value.length == 0)
        return;
      yield this.plugin.saveSettings();
    })));
    new import_obsidian7.Setting(this.containerEl).setName("Non Player Character Tag").addText((text) => text.setPlaceholder("rpgm/element/character/npc").setValue(this.plugin.settings.npcTag).onChange((value) => __async(this, null, function* () {
      if (value.length == 0)
        return;
      yield this.plugin.saveSettings();
    })));
    new import_obsidian7.Setting(this.containerEl).setName("Location Tag").addText((text) => text.setPlaceholder("rpgm/element/location").setValue(this.plugin.settings.locationTag).onChange((value) => __async(this, null, function* () {
      if (value.length == 0)
        return;
      yield this.plugin.saveSettings();
    })));
    new import_obsidian7.Setting(this.containerEl).setName("Faction Tag").addText((text) => text.setPlaceholder("rpgm/element/faction").setValue(this.plugin.settings.factionTag).onChange((value) => __async(this, null, function* () {
      if (value.length == 0)
        return;
      yield this.plugin.saveSettings();
    })));
    new import_obsidian7.Setting(this.containerEl).setName("Event Tag").addText((text) => text.setPlaceholder("rpgm/element/event").setValue(this.plugin.settings.eventTag).onChange((value) => __async(this, null, function* () {
      if (value.length == 0)
        return;
      yield this.plugin.saveSettings();
    })));
    new import_obsidian7.Setting(this.containerEl).setName("Clue Tag").addText((text) => text.setPlaceholder("rpgm/element/clue").setValue(this.plugin.settings.clueTag).onChange((value) => __async(this, null, function* () {
      if (value.length == 0)
        return;
      yield this.plugin.saveSettings();
    })));
    new import_obsidian7.Setting(this.containerEl).setName("Timeline Tag").addText((text) => text.setPlaceholder("rpgm/element/timeline").setValue(this.plugin.settings.timelineTag).onChange((value) => __async(this, null, function* () {
      if (value.length == 0)
        return;
      yield this.plugin.saveSettings();
    })));
    new import_obsidian7.Setting(this.containerEl).setName("Note Tag").addText((text) => text.setPlaceholder("rpgm/element/note").setValue(this.plugin.settings.noteTag).onChange((value) => __async(this, null, function* () {
      if (value.length == 0)
        return;
      yield this.plugin.saveSettings();
    })));
  }
};

// src/main.ts
var RpgManager = class extends import_obsidian8.Plugin {
  onload() {
    return __async(this, null, function* () {
      yield this.loadSettings();
      console.log("Loading RpgManager " + this.manifest.version);
      this.addSettingTab(new RpgManagerSettingTab(this.app, this));
      this.api = new Api(this.app, this.settings);
      RpgViewFactory.initialise(this.api);
      RpgModelFactory.initialise(this.api);
      this.refreshViews = (0, import_obsidian8.debounce)(this.refreshViews, 2500, true);
      this.registerEvent(this.app.metadataCache.on("resolved", function() {
        this.refreshViews();
      }.bind(this)));
      this.registerEvent(this.app.vault.on("modify", function() {
        this.refreshViews();
      }.bind(this)));
      this.registerPriorityCodeblockPostProcessor("RpgManager", -100, (source, el, ctx) => __async(this, null, function* () {
        return this.createRpgView(source, el, ctx, ctx.sourcePath);
      }));
      Object.keys(DataType).filter((v) => isNaN(Number(v))).forEach((type, index) => {
        this.addCommand({
          id: "rpg-manager-create-" + type.toLowerCase(),
          name: "Create a new " + type,
          callback: () => {
            this.api.fileFactory.initialise(DataType[type]);
          }
        });
        this.addCommand({
          id: "rpg-manager-fill-" + type.toLowerCase(),
          name: "Fill with " + type,
          callback: () => {
            this.api.fileFactory.initialise(DataType[type], false);
          }
        });
      });
    });
  }
  onunload() {
    return __async(this, null, function* () {
      __superGet(RpgManager.prototype, this, "onunload").call(this);
      this.app.workspace.off("resolved", this.refreshViews);
      this.app.workspace.off("modify", this.refreshViews);
    });
  }
  refreshViews() {
    this.app.workspace.trigger("rpgmanager:refresh-views");
  }
  createRpgView(source, el, component, sourcePath) {
    return __async(this, null, function* () {
      this.app.plugins.plugins.dataview.api.index.touch();
      component.addChild(RpgModelFactory.create(el, source, component, sourcePath));
    });
  }
  registerPriorityCodeblockPostProcessor(language, priority, processor) {
    const registered = this.registerMarkdownCodeBlockProcessor(language, processor);
    registered.sortOrder = priority;
  }
  registerPriorityMarkdownPostProcessor(priority, processor) {
    const registered = this.registerMarkdownPostProcessor(processor);
    registered.sortOrder = priority;
  }
  loadSettings() {
    return __async(this, null, function* () {
      this.settings = Object.assign({}, DEFAULT_SETTINGS, yield this.loadData());
    });
  }
  saveSettings() {
    return __async(this, null, function* () {
      yield this.saveData(this.settings);
      RpgModelFactory.initialise(this.api);
    });
  }
};
